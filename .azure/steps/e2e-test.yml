steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '18'
    displayName: 'Install Node.js'

  - script: pnpm i
    displayName: 'pnpm i'

  - task: qetza.replacetokens.replacetokens-task.replacetokens@6
    inputs:
      sources: |
        **/.env.template
      tokenPattern: custom
      tokenPrefix: '{'
      tokenSuffix: '}'
      telemetryOptout: true

    displayName: "Replace tokens"

  - script: mv apps/tests/.env.template apps/tests/.env
    displayName: 'Rename .env.template'

  - script: |
      cd apps/tests
      pnpm test
    displayName: 'Run e2e tests'

