steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '18'
    displayName: 'Install Node.js'

  - script: |
      rm -r ./apps/web
      rm -r ./apps/server
      rm -r ./packages
    displayName: 'Keep only tests app'

  - template: ./pnpm-install.yml
  - script: pnpm exec playwright install
    displayName: 'Install Playwright'

  - task: qetza.replacetokens.replacetokens-task.replacetokens@6
    inputs:
      sources: |
        **/.env.template
      tokenPattern: custom
      tokenPrefix: '{'
      tokenSuffix: '}'
      telemetryOptout: true

    displayName: "Replace tokens"

  - script: mv apps/tests/.env.template apps/tests/.env
    displayName: 'Rename .env.template'

  - script: |
      cd apps/tests
      pnpm test
    displayName: 'Run e2e tests'

